(function(factory){typeof define==="function"&&define.amd?define(factory):factory()}((function(){var parseMessage=function(json){if(!json){return}return JSON.parse(json)};function randomString(length,chars){if(chars===void 0){chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"}var text="";for(var i=0;i<length;i++){text+=chars.charAt(Math.floor(Math.random()*chars.length))}return text}var invoke=function(fn,param){return(param===undefined?fn():fn(param))};var AbstractBridge=function AbstractBridge(){this._callbacks=Object.create(null);this._handlers=Object.create(null);this._nonce=randomString(10);this._uuid=0;this._setup()};AbstractBridge.prototype._getCallbackId=function _getCallbackId(callback){var id=(this._nonce)+"_"+(this._uuid++);this._callbacks[id]=callback;return id};AbstractBridge.prototype._receiveCallback=function _receiveCallback(callbackId,data){var callback=this._callbacks[callbackId];if(callback){delete this._callbacks[callbackId];invoke(callback,data)}};AbstractBridge.prototype._receiveEvent=function _receiveEvent(eventType,data){var handler=this._handlers[eventType];handler&&invoke(handler,data)};AbstractBridge.prototype.invoke=function invoke(name,data){var this$1=this;if(data===void 0){data={}}return new Promise(function(resolve){var id=this$1._getCallbackId(resolve);this$1._send(name,data,id)})};AbstractBridge.prototype.handler=function handler(eventType,callback){this._handlers[eventType]=callback};AbstractBridge.prototype.ready=function ready(){this._ready()};var needImplement=function(name){return function(){throw new Error(("[bridge-core] "+name+" must be implemented"))}};Object.assign(AbstractBridge.prototype,{_setup:needImplement("_setup"),_send:needImplement("_send"),_ready:needImplement("_ready")});function multiplex(stubs){var listeners=[];var multiplexer={$push:function $push(listener){listeners.push(listener)}};Object.keys(stubs).forEach(function(key){var val=stubs[key];if(typeof val==="function"){multiplexer[key]=function(){var args=[],len=arguments.length;while(len--){args[len]=arguments[len]}for(var index=0;index<listeners.length;index++){val.apply(listeners[index],args)}}}else{multiplexer[key]=val}});return multiplexer}function adapterAndroid(AbstractBridge){return(function(AbstractBridge){function AndroidBridge(){AbstractBridge.apply(this,arguments)}if(AbstractBridge){AndroidBridge.__proto__=AbstractBridge}AndroidBridge.prototype=Object.create(AbstractBridge&&AbstractBridge.prototype);AndroidBridge.prototype.constructor=AndroidBridge;AndroidBridge.prototype._setup=function _setup(){if(!window.BardApp){window.BardApp=multiplex({callbackFromNative:function callbackFromNative(callbackId,_,json){this._receiveCallback(callbackId,parseMessage(json))},eventFromNative:function eventFromNative(eventType,json){this._receiveEvent(eventType,parseMessage(json))}})}window.BardApp.$push(this)};AndroidBridge.prototype._send=function _send(name,data,callbackId){window.BardMagicalJourney.messageSend(name,callbackId,JSON.stringify(data))};AndroidBridge.prototype._ready=function _ready(){window.BardMagicalJourney.bridgeReady()};return AndroidBridge}(AbstractBridge))}var messageHandlers=(typeof window!=="undefined"&&window.webkit&&window.webkit.messageHandlers)||{};var postMessage=function(name,data){if(data===void 0){data={}}if(messageHandlers[name]){messageHandlers[name].postMessage(data)}};function adapterIOS(AbstractBridge){return(function(AbstractBridge){function WKWebviewBridge(){AbstractBridge.apply(this,arguments)}if(AbstractBridge){WKWebviewBridge.__proto__=AbstractBridge}WKWebviewBridge.prototype=Object.create(AbstractBridge&&AbstractBridge.prototype);WKWebviewBridge.prototype.constructor=WKWebviewBridge;WKWebviewBridge.prototype._setup=function _setup(){if(!window.BNCBridge){window.BNCBridge=multiplex({receive:function receive(json){var ref=parseMessage(json);var callbackId=ref.callbackId;var eventType=ref.eventType;var data=ref.data;if(callbackId){this._receiveCallback(callbackId,data);return}if(eventType){this._receiveEvent(eventType,data)}}})}window.BNCBridge.$push(this)};WKWebviewBridge.prototype._send=function _send(name,data,callbackId){postMessage(name,{data:JSON.stringify(data),callbackId:callbackId})};WKWebviewBridge.prototype._ready=function _ready(){postMessage("bridgeReady")};return WKWebviewBridge}(AbstractBridge))}var BrowserAdapterFactory=function BrowserAdapterFactory(){this._methods=Object.create(null)};BrowserAdapterFactory.prototype.add=function add(name,method){this._methods[name]=method;return this};BrowserAdapterFactory.prototype._send=function _send(name,params,callbackId){var this$1=this;var method=this._methods[name];if(!method){return console.error(("[bridge-core] bridge."+name+" is not defined"))}method(params,function(data){this$1._receiveCallback(callbackId,data)})};BrowserAdapterFactory.prototype.create=function create(className){var browser=this;return function(AbstractBridge){var obj={};obj[className]=(function(AbstractBridge){function anonymous(){AbstractBridge.apply(this,arguments)}if(AbstractBridge){anonymous.__proto__=AbstractBridge}anonymous.prototype=Object.create(AbstractBridge&&AbstractBridge.prototype);anonymous.prototype.constructor=anonymous;anonymous.prototype._setup=function _setup(){if(!browser._bridge){browser._bridge=multiplex({receiveCallback:function receiveCallback(){var ref;var args=[],len=arguments.length;while(len--){args[len]=arguments[len]}(ref=this)._receiveCallback.apply(ref,args)},receiveEvent:function receiveEvent(){var ref;var args=[],len=arguments.length;while(len--){args[len]=arguments[len]}(ref=this)._receiveEvent.apply(ref,args)}})}browser._receiveCallback=browser._bridge.receiveCallback;if(typeof window!=="undefined"){window.BridgeReceiveEvent=browser._bridge.receiveEvent}browser._bridge.$push(this)};anonymous.prototype._send=function _send(name,data,callbackId){browser._send(name,data,callbackId)};anonymous.prototype._ready=function _ready(){};return anonymous}(AbstractBridge));return obj[className]}};var asyncTag="[object AsyncFunction]";var funcTag="[object Function]";var genTag="[object GeneratorFunction]";var isObject=function(value){var type=typeof value;return value!=null&&(type==="object"||type==="function")};var getObjectTag=function(value){return Object.prototype.toString.call(value)};var isFunction=function(value){if(!isObject(value)){return false}var tag=getObjectTag(value);return tag===funcTag||tag===genTag||tag===asyncTag};var isHybrid=function(){return/BNC\/([0-9.]+)/i.test(navigator.userAgent)};var isAndroid=function(){return/android/i.test(navigator.userAgent)};var isIOS=function(){return/iphone|ipad/i.test(navigator.userAgent)};var dispatchReady=function(){var fn=function(){var event=new CustomEvent("BinanceJSBridgeReady",{bubbles:false,cancelable:false,});document.dispatchEvent(event)};if(document.readyState==="complete"){fn()}else{window.addEventListener("load",function(){fn()})}};function createBridge(base){var bridge=Object.create(null);bridge.invoke=function(name,args,cb){base.invoke(name,args).then(function(data){if(isFunction(cb)){cb(data)}})};base.ready();return bridge}var BridgeFactory=function BridgeFactory(defaultAdapter){this.defaultAdapter=defaultAdapter;this.adapters=[]};BridgeFactory.prototype.registerAdapter=function registerAdapter(ref){var test=ref.test;var adapter=ref.adapter;this.adapters.push({test:test,adapter:adapter});return this};BridgeFactory.prototype.create=function create(){var factory=this.defaultAdapter;this.adapters.some(function(ref){var test=ref.test;var adapter=ref.adapter;if(test()){factory=adapter;return true}return false});var BridgeCore=factory(AbstractBridge);return createBridge(new BridgeCore())};function createBrowserAdapter(methods){if(methods===void 0){methods={}}var factory=new BrowserAdapterFactory();Object.keys(methods).forEach(function(name){factory.add(name,methods[name])});return factory.create("BrowserMockBridge")}var bridge=null;function initBridge(adapter){if(bridge){return bridge}bridge=new BridgeFactory(adapter).registerAdapter({test:function(){return isHybrid()&&isAndroid()},adapter:adapterAndroid,}).registerAdapter({test:function(){return isHybrid()&&isIOS()},adapter:adapterIOS,}).create();window.BinanceJSBridge=bridge;dispatchReady();return bridge}var browserAdapter=createBrowserAdapter({});initBridge(browserAdapter)})));